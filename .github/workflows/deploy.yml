name: Deploy to shinyapps.io

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup R
      uses: r-lib/actions/setup-r@v2
      with:
        r-version: '4.3'  # ou a versão que você usa
    
    - name: Install dependencies
      run: |
        R -e "install.packages(c('shiny', 'shinydashboard', 'plotly', 'DT', 'dplyr', 'lubridate', 'corrplot', 'reshape2', 'httr', 'jsonlite', 'rsconnect'))"
    
    - name: Deploy to shinyapps.io
      if: github.event_name == 'push' && github.ref == 'refs/heads/main'
      env:
        SHINYAPPS_NAME: ${{ secrets.SHINYAPPS_NAME }}
        SHINYAPPS_TOKEN: ${{ secrets.SHINYAPPS_TOKEN }}
        SHINYAPPS_SECRET: ${{ secrets.SHINYAPPS_SECRET }}
      run: |
        R -e "rsconnect::setAccountInfo(name = '${{ secrets.SHINYAPPS_NAME }}', token = '${{ secrets.SHINYAPPS_TOKEN }}', secret = '${{ secrets.SHINYAPPS_SECRET }}')"
        R -e "rsconnect::deployApp(appDir = '.', appName = 'monitoramento-simcosta', account = '${{ secrets.SHINYAPPS_NAME }}')"
