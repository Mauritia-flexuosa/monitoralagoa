name: Deploy to shinyapps.io

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup R
      uses: r-lib/actions/setup-r@v2
    
    - name: Install packages
      run: |
        R -e "install.packages(c('rsconnect', 'shiny', 'shinydashboard', 'plotly', 'DT', 'dplyr', 'lubridate', 'corrplot', 'reshape2'), repos = 'https://cloud.r-project.org')"
    
    - name: Deploy
      env:
        SHINYAPPS_NAME: ${{ secrets.SHINYAPPS_NAME }}
        SHINYAPPS_TOKEN: ${{ secrets.SHINYAPPS_TOKEN }}
        SHINYAPPS_SECRET: ${{ secrets.SHINYAPPS_SECRET }}
      run: |
        R -e "library(rsconnect)"
        R -e "rsconnect::setAccountInfo(name = '$SHINYAPPS_NAME', token = '$SHINYAPPS_TOKEN', secret = '$SHINYAPPS_SECRET')"
        R -e "rsconnect::deployApp('.', appName = 'monitoralagoa', account = '$SHINYAPPS_NAME', forceUpdate = TRUE)"
